"use strict";var f=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var b=Object.prototype.hasOwnProperty;var T=(e,t)=>{for(var s in t)f(e,s,{get:t[s],enumerable:!0})},v=(e,t,s,g)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of N(t))!b.call(e,o)&&o!==s&&f(e,o,{get:()=>t[o],enumerable:!(g=w(t,o))||g.enumerable});return e};var y=e=>v(f({},"__esModule",{value:!0}),e);var M={};T(M,{default:()=>h});module.exports=y(M);var n=require("@raycast/api");var d=require("@raycast/api"),x=require("node:child_process");var a=class extends Error{},r=class extends Error{},l=class extends Error{},c=class extends Error{},u=class extends Error{};function m(e=!0){let t=p(`status --json --peers=${e}`),s=JSON.parse(t);if(!s||!s.Self.Online)throw new l;return s}var i=(0,d.getPreferenceValues)(),I=i.tailscalePath&&i.tailscalePath.length>0?i.tailscalePath:"/Applications/Tailscale.app/Contents/MacOS/Tailscale",E=i.tailscaleExecMaxBuffersMB&&i.tailscaleExecMaxBuffersMB?i.tailscaleExecMaxBuffersMB*1024*1024:10*1024*1024;function p(e){try{return(0,x.execSync)(`${I} ${e}`,{maxBuffer:E}).toString().trim()}catch(t){if(t instanceof Error){if(t.message.includes("No such file or directory"))throw new a;if(t.message.includes("is Tailscale running?"))throw new r;if(t.message.includes("spawnSync /bin/sh ENOBUFS"))throw new c;if(t.message.includes('The value of "options.maxBuffer" is out of range. It must be a positive number. Received NaN'))throw new u}throw console.log(`throwing error: ${t}`),t}}function S(e,t){return e instanceof a?{title:"Can\u2019t find the Tailscale CLI",description:`Your Tailscale CLI Path is invalid.
Update your extension preferences to fix this.`}:e instanceof r?{title:"Can\u2019t connect to Tailscale",description:"Make sure Tailscale is running and try again."}:e instanceof l?{title:"Not connected to a tailnet",description:`Tailscale is running, but you\u2019re not connected to a tailnet.
Log in and try again.`}:e instanceof c?{title:"Response larger than buffer size",description:"Increase `Max buffers ...` in the extension configuration."}:e instanceof u?{title:"Invalid `Max buffers ...` configuration",description:"Set `Max buffers ...` to a number in the extension configuration."}:(console.log(`Unhandled error: ${e}`),{title:"Something went wrong",description:t})}function D(e){return new Promise(t=>setTimeout(t,e))}async function h(){let e;try{await(0,n.showToast)({style:n.Toast.Style.Animated,title:"Connecting"}),await(0,n.updateCommandMetadata)({subtitle:""}),(0,n.popToRoot)(),(0,n.closeMainWindow)(),p("up"),await D(2e3),e=`Connected on ${m(!1).MagicDNSSuffix}`,(0,n.showHUD)(e)}catch(t){console.error(t),e=S(t,"").title,(0,n.showHUD)(`Unable to connect: ${e}`)}await(0,n.updateCommandMetadata)({subtitle:e})}
